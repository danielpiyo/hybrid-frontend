<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hybrid Medical KG – Concept Extractor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .spinner {
            border: 4px solid #eee;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            animation: spin 0.7s linear infinite;
            margin: auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>

<body class="bg-gray-100">

    <div class="max-w-3xl mx-auto mt-10 bg-white shadow-lg p-8 rounded-lg">
        <h1 class="text-3xl font-bold mb-4 text-center">Hybrid Medical Concept Extractor</h1>
        <p class="text-gray-600 text-center mb-6">
            Enter medical text below to extract concepts, mappings, URIs and ontology hierarchy.
        </p>

        <!-- API URL -->
        <div class="mb-4">
            <label class="font-semibold text-gray-700">API URL:</label>
            <input id="apiUrl" type="text"
                   class="w-full mt-1 p-2 border rounded"
                   placeholder="https://226dc8d5772d.ngrok-free.app/predict"
                   value="">
        </div>

        <!-- Textbox -->
        <textarea id="inputText"
                  class="w-full border rounded p-3 h-40"
                  placeholder="Enter medical text here..."></textarea>

        <!-- Button -->
        <button onclick="runPrediction()"
                class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded">
            Extract Concepts
        </button>

        <!-- Status -->
        <div id="status" class="mt-4 text-center text-gray-700"></div>

        <!-- Results -->
        <div id="results" class="mt-6"></div>
    </div>

    <script>
        async function runPrediction() {
            const text = document.getElementById("inputText").value.trim();
            const apiUrl = document.getElementById("apiUrl").value.trim();
            const status = document.getElementById("status");
            const results = document.getElementById("results");

            if (!text) {
                alert("Please enter text.");
                return;
            }
            if (!apiUrl) {
                alert("Please enter your API URL.");
                return;
            }

            status.innerHTML = `<div class='spinner'></div><p>Processing...</p>`;
            results.innerHTML = "";

            try {
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ text: text })
                });

                const data = await response.json();
                status.innerHTML = "";

                if (data.error) {
                    results.innerHTML = `<p class='text-red-500'>Error: ${data.error}</p>`;
                    return;
                }

                displayResults(data);

            } catch (err) {
                status.innerHTML = "";
                results.innerHTML = `<p class='text-red-600 font-semibold'>❌ Connection error: ${err}</p>`;
            }
        }

        function displayResults(data) {
            const results = document.getElementById("results");

            let html = `
                <h2 class="text-2xl font-bold mb-3">Extracted Concepts (${data.count})</h2>
            `;

            data.predictions.forEach(p => {
                html += `
                    <div class="bg-gray-50 border rounded p-4 mb-4">
                        <p><strong>Model Label:</strong> ${p.model_label}</p>
                        <p><strong>Cleaned:</strong> ${p.cleaned_label}</p>
                        <p><strong>Mapped Label:</strong> ${p.mapped_label}</p>
                        <p><strong>Ontology:</strong> ${p.ontology || "❌ Not Found"}</p>
                        <p><strong>URI:</strong> ${
                            p.uri ? `<a class="text-blue-600 underline" target="_blank" href="${p.uri}">${p.uri}</a>` : "❌"
                        }</p>

                        <p class="mt-2">
                            <strong>Parents:</strong>
                            <br><span class="text-gray-700">${p.parents.join(", ") || "None"}</span>
                        </p>

                        <p class="mt-2">
                            <strong>Ancestors:</strong>
                            <br><span class="text-gray-700">${p.ancestors.join(", ") || "None"}</span>
                        </p>
                    </div>
                `;
            });

            results.innerHTML = html;
        }
    </script>

</body>
</html>
